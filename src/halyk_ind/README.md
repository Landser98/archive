# Halyk Bank Individual - Batch Parser

## Описание

Batch-парсер для обработки выписок Halyk Bank (индивидуальные). Парсит PDF файлы и генерирует аналитические таблицы для UI.

## Использование

```bash
python src/halyk_ind/batch_parse.py <input_path> [опции]
```

### Параметры

- `input_path` - Путь к PDF файлу или директории с PDF файлами (обязательный)
- `--out-dir` - Директория для выходных CSV файлов (по умолчанию: `<base_dir>/out` или `halyk_parsed` для одного файла)

### Примеры

```bash
# Обработать один файл
python src/halyk_ind/batch_parse.py data/halyk_individual/statement.pdf

# Обработать все PDF в директории
python src/halyk_ind/batch_parse.py data/halyk_individual/

# Указать выходную директорию
python src/halyk_ind/batch_parse.py data/halyk_individual/ --out-dir results/
```

## Input (Входные данные)

### PDF файлы
- **Формат**: PDF выписки Halyk Bank (индивидуальные)
- **Расположение**: `data/halyk_individual/*.pdf`
- **Можно указать**: один файл или директорию с файлами

## Промежуточные файлы

### JSONL страниц
- **Путь**: Создается во временной директории (удаляется после обработки)
- **Содержит**: постраничный дамп PDF в формате pdfplumber
- **Создается автоматически** и удаляется после обработки

## Output (Выходные данные)

Все файлы сохраняются в директории `data/halyk_individual_out/` (или указанной через `--out-dir`):

### 1. `<stem>_header.csv`
Заголовок выписки
- Информация о периоде
- Информация о счете

### 2. `<stem>_tx.csv`
Транзакции
- Дата операции
- Сумма операции (или Доход/Расход)
- Описание операции
- **Важно**: Описания операций очищены от префиксов:
  - "Операция оплаты у коммерсанта "
  - "Поступление перевода "
  - "Перевод на другую карту "

### 3. `<stem>_footer.csv`
Итоговая информация
- Итоговые данные выписки

### 4. `<stem>_ui_debit_top_9.csv`
Топ-9 дебетовых операций
- Контрагент
- Сумма дебетовых операций
- Количество операций
- Ранг

### 5. `<stem>_ui_credit_top_9.csv`
Топ-9 кредитовых операций
- Контрагент
- Сумма кредитовых операций
- Количество операций
- Ранг

### 6. `<stem>_ui_related_parties_net.csv`
Связанные стороны (Net)
- Контрагент
- Чистая сумма операций (кредит - дебет)
- Количество операций
- Анализ связанных сторон

## Особенности

- Использует pdfplumber для извлечения данных из PDF
- **Очищает описания операций** от стандартных префиксов Halyk Bank
- Генерирует аналитические таблицы для UI (Топ-9 и связанные стороны)
- **Не вычисляет доходы ИП** (в отличие от других парсеров)
- JSONL файлы создаются во временной директории и автоматически удаляются

## Очистка описаний операций

Парсер автоматически удаляет следующие префиксы из описаний операций:
- "Операция оплаты у коммерсанта "
- "Поступление перевода "
- "Перевод на другую карту "

Это позволяет получить чистые имена контрагентов для анализа.

## Формат дат

- Формат дат зависит от структуры выписки (определяется автоматически)

## Кодировка

Все CSV файлы сохраняются с кодировкой `utf-8-sig` (UTF-8 с BOM) для корректного отображения в Excel.

